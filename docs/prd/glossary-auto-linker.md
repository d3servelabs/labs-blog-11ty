# 自动化词汇表术语链接工具 PRD

## 1. 项目背景与目标

### 背景
在手工为博客文章添加词汇表术语链接的过程中，发现了以下问题：
- 手工识别和标记术语耗时较长，容易遗漏
- 链接格式需要保持一致性（使用Eleventy URL过滤器）
- 新增词汇表术语后需要回溯更新所有相关文章
- 词汇表文章之间的交叉引用也需要手工维护

### 目标
开发一个自动化工具，能够：
- 自动识别文章中的词汇表术语
- 自动添加格式正确的链接
- 支持批量处理和增量更新
- 提供安全的备份和回滚机制

## 2. 需求分析

### 2.1 手工操作经验总结
基于实际操作经验，发现以下关键模式：

**术语识别模式：**
- 需要识别文章中出现的所有词汇表术语（如NFT、smart contract、registrar等）
- 处理术语变体：复数形式（NFT/NFTs）、大小写变化、连字符变体
- 避免部分匹配造成的误链接

**链接格式要求：**
- 统一使用 `[term]({{ '/en/glossary/term/' | url }})` 格式
- 确保baseURL="/r"配置正确应用
- 保持原文的markdown结构

**链接策略：**
- 每段中相同术语只在首次出现时添加链接
- 避免重复链接或破坏现有链接
- 词汇表文章之间需要交叉引用

### 2.2 技术挑战
1. **术语匹配精度**：避免部分匹配，使用词边界识别
2. **上下文感知**：区分专业术语使用和普通词汇
3. **已存在链接检测**：不破坏现有链接结构
4. **性能优化**：处理大量文件时的效率
5. **多语言预备**：为将来的多语言支持做准备

## 3. 技术方案

### 3.1 核心架构
```
自动化词汇表链接工具
├── 词汇表术语提取器 (Term Extractor)
├── 文章扫描器 (Article Scanner)  
├── 术语匹配引擎 (Matching Engine)
├── 链接插入器 (Link Inserter)
└── 配置管理器 (Config Manager)
```

### 3.2 技术栈
- **运行环境**: Node.js + ES Modules
- **核心依赖**:
  - `fs-extra`: 文件系统操作
  - `gray-matter`: Markdown前置数据解析
  - `glob`: 文件模式匹配
  - `commander`: 命令行接口
  - `chalk`: 控制台输出美化

### 3.3 核心功能模块

#### 词汇表术语提取器
- 扫描 `src/en/glossary/` 目录
- 提取每个文件的标题作为主要术语
- 生成术语变体（复数、大小写、连字符变化）
- 创建术语到URL的映射表

#### 术语匹配引擎
- 使用正则表达式进行精确匹配
- 支持词边界检测避免部分匹配
- 处理已存在链接，避免重复
- 优先匹配长术语（避免短词被错误匹配）

#### 链接插入器
- 在每段中为术语首次出现添加链接
- 使用Eleventy URL过滤器格式
- 保持原文格式和结构
- 生成备份文件

### 3.4 脚本结构
```
scripts/
├── glossary-linker.mjs          # 主脚本入口
├── lib/
│   ├── term-extractor.mjs       # 术语提取逻辑
│   ├── article-processor.mjs    # 文章处理逻辑
│   ├── link-generator.mjs       # 链接生成逻辑
│   └── utils.mjs               # 通用工具函数
├── config/
│   └── glossary-config.json    # 配置文件
└── tests/
    └── glossary-linker.test.mjs # 单元测试
```

## 4. 实施计划

### 4.1 开发阶段

#### 阶段1: 基础框架 (1-2天)
- [x] 需求分析和方案设计
- [ ] 创建项目结构和配置文件
- [ ] 实现词汇表术语提取功能
- [ ] 开发命令行接口框架

#### 阶段2: 核心功能 (2-3天)
- [ ] 实现术语匹配算法
- [ ] 开发链接插入逻辑
- [ ] 添加重复链接检测
- [ ] 实现备份和回滚功能

#### 阶段3: 测试优化 (1-2天)
- [ ] 性能优化和错误处理
- [ ] 编写单元测试用例
- [ ] 添加详细日志和进度显示
- [ ] 编写使用文档

#### 阶段4: 高级功能 (可选)
- [ ] 支持增量更新模式
- [ ] 添加预览模式（dry-run）
- [ ] 集成到构建流程
- [ ] 多语言支持框架

### 4.2 配置示例
```json
{
  "glossaryPath": "src/en/glossary/",
  "articlePaths": [
    "src/en/blog/*.md",
    "src/en/tld/*.md"
  ],
  "excludePaths": [
    "src/en/glossary/*"
  ],
  "linkTemplate": "[{term}]({{ '/en/glossary/{slug}/' | url }})",
  "backup": true,
  "linksPerParagraph": 1,
  "ignoredTerms": ["the", "and", "or"]
}
```

### 4.3 使用方式
```bash
# 安装依赖
npm install

# 处理所有博客文章
npm run glossary:link

# 处理特定文件
npm run glossary:link -- src/en/blog/why-tokenize-domains.md

# 预览模式（不修改文件）
npm run glossary:link -- --dry-run

# 恢复备份
npm run glossary:restore

# 显示帮助
npm run glossary:link -- --help
```

## 5. 预期效果

### 5.1 效率提升
- **时间节省**: 相比手工操作节省90%+的时间
- **一致性**: 保证所有链接格式统一正确
- **完整性**: 自动发现所有术语，避免遗漏

### 5.2 质量改进
- **准确性**: 减少人为错误和遗漏
- **维护性**: 新增术语后可自动更新所有文章
- **可靠性**: 提供备份和回滚机制

### 5.3 工作流程优化
- **自动化**: 集成到CI/CD流程
- **可重复**: 标准化的处理流程
- **可扩展**: 支持多语言和新需求

## 6. 风险评估

### 6.1 技术风险
- **误匹配风险**: 可能错误识别非术语词汇
  - 缓解：使用词边界检测和配置黑名单
- **性能风险**: 大量文件处理可能较慢
  - 缓解：增量更新和并行处理

### 6.2 数据风险
- **文件损坏**: 自动修改可能破坏原文
  - 缓解：强制备份和回滚功能
- **格式破坏**: 可能影响markdown结构
  - 缓解：严格的正则表达式和测试

### 6.3 维护风险
- **依赖更新**: 第三方库更新可能影响功能
  - 缓解：锁定版本和定期测试
- **需求变更**: 新的链接格式要求
  - 缓解：配置化和模块化设计

## 7. 后续优化方向

### 7.1 功能增强
- **智能识别**: 使用NLP技术提高术语识别准确率
- **语义分析**: 基于上下文判断是否需要添加链接
- **批量更新**: 支持词汇表术语重命名时的批量更新

### 7.2 集成优化
- **编辑器插件**: 开发VSCode插件支持实时预览
- **CI/CD集成**: 自动检查新文章的术语链接
- **Web界面**: 提供图形化界面进行配置和操作

### 7.3 多语言支持
- **国际化**: 支持其他语言的词汇表处理
- **跨语言引用**: 支持不同语言间的术语链接
- **本地化配置**: 针对不同语言的特殊处理规则

---

## 附录：手工操作经验记录

### 实际处理的术语示例
在 `why-tokenize-domains.md` 文件中成功添加的术语链接：
- NFT (3次出现)
- Registrar/Registrars (6次出现)
- Wallet (6次出现)  
- Smart contracts (4次出现)
- DAO/DAOs (4次出现)
- DNS, Auctions, Composability等

### 交叉引用模式
在词汇表文章中添加的交叉引用：
- NFT → wallet, Web3
- Smart contract → automated delegation, revenue sharing, Web3
- DAO → smart contracts
- Marketplace → NFTs, wallets, escrow, smart contracts

### 链接格式验证
所有链接均使用格式：`[term]({{ '/en/glossary/term/' | url }})`
确保与Eleventy配置的baseURL="/r"兼容。

---

*文档创建时间: 2025-06-30*  
*最后更新: 2025-06-30*  
*状态: 需求分析完成，待开发*